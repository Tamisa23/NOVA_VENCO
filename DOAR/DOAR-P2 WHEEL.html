<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <meta charset="UTF-8"/>
    <meta name="viveport" content="width=device-width, initial-scale=1.0" />
    <title>Page Title</title>
    <link rel="stylesheet" href="/DOAR/DOAR-P2 WHEEL.css" />
    <link rel="icon" type="image/x-icon" href="/image/HOME/LOGO VENCO .png">


  </head>
  <body>


  <div class="GP">
    <a><img id="imgWheelOff" src="/image/DOAR/Wheel/BG.jpg"></a>
    <a><img id="imgWheelOn" src="/image/DOAR/Wheel/GIF/GIF-WHEEL-P2.gif"></a>
    </div>
    
    


    <div class="GP"> 
        
      
        <div class="EmerP2">
            <a href="#" id="EMCImg" class="hover-effect float"><img src="/image/DOAR/P2/BG-EMC.png" width="150" height="150"></a>
        </div>
          


        <div class="home">
          <a href="/DOAR/DOAR-P1.html"><img src="/image/DOAR/P1/Not.png" width="300" height="150"></a>
      </div>
  
      <div class="GPbox1">
        <div id="flow_sa" class="box">40</div>
      </div>
      <div class="GPbox2">
        <div id="eff" class="box">20</div>
      </div>
      <div class="GPbox3">
          <div id="flow_ea" class="box">10</div>
        </div>
  

    <script>
      // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT Broker ‡∏ú‡πà‡∏≤‡∏ô WebSockets
      const mqttClient = mqtt.connect("wss://2217876f209d4a73af014e541592ee16.s1.eu.hivemq.cloud:8884/mqtt", {
          username: "Venco",
          password: "12345678Venco",
          rejectUnauthorized: false // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SSL Certificate (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
      });
    
      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      mqttClient.on("connect", function () {
          console.log("‚úÖ MQTT Connected!");
          mqttClient.subscribe("DOAR", function (err) {
              if (!err) {
                  console.log("‚úÖ Subscribed to DOAR");
              }
          });
      });

      function updateElement(id, value) {
    let element = document.getElementById(id);
    if (element) {
        let displayValue = Array.isArray(value) ? value[0] : value; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å
        element.innerText = parseFloat(displayValue).toFixed(2); // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
    } else {
        console.warn(`‚ö†Ô∏è Element with ID '${id}' not found`);
    }
}

  
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Wheel GIF
function updateWheel(WheelValue) {
    let imgWheelOn = document.getElementById("imgWheelOn");  // ‡πÉ‡∏ä‡πâ ID ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    let imgWheelOff = document.getElementById("imgWheelOff");

    if (!imgWheelOn || !imgWheelOff) {
        console.warn("‚ö†Ô∏è Wheel images not found in the DOM");
        return;
    }

    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô
    imgWheelOn.style.display = "none";
    imgWheelOff.style.display = "none";

    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ WheelValue
    if (WheelValue === 1) {
        imgWheelOn.src = "/image/DOAR/Wheel/GIF/GIF-WHEEL-P2.gif?random=" + new Date().getTime();  // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä GIF
        imgWheelOn.style.display = "block";  
    } else {
        imgWheelOff.style.display = "block";
    }
}


    
mqttClient.on("message", function (topic, message) {
    try {
        var data = JSON.parse(message.toString());
        console.log("üì© Received MQTT Data:", data); // Debug log 

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤ Wheel
        if (data.Wheel !== undefined) {
            let WheelValue = parseInt(data.Wheel, 10);
            console.log("‚öôÔ∏è Wheel:", WheelValue);
            updateWheel(WheelValue); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
        }

    } catch (error) {
        console.error("‚ùå Error parsing MQTT message:", error);
    }
});



      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
      document.addEventListener("DOMContentLoaded", function() {
          console.log("üìå DOM Loaded, Ready to receive MQTT messages.");
      });
    
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏≠‡∏á MQTT
      mqttClient.on("error", function (error) {
          console.error("‚ùå MQTT Error:", error);
      });
    
      mqttClient.on("close", function () {
          console.warn("‚ö†Ô∏è MQTT Disconnected! Reconnecting...");
      });
    
// üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° EMC ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `EMC`
function updateEMCGUI(value) {
    let EMCImg = document.getElementById("EMCImg"); // ‡πÉ‡∏ä‡πâ EMCImg ‡πÅ‡∏ó‡∏ô LTGImg

    if (EMCImg) {
        console.log("üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ EMC:", value);
        if (value === 1) {
            EMCImg.src = "/image/DOAR/icon/EMC.png"; // ‡∏£‡∏π‡∏õ EMC ‡πÄ‡∏õ‡∏¥‡∏î
        } else {
            EMCImg.src = "/image/DOAR/P2/BG-EMC.png"; // ‡∏£‡∏π‡∏õ EMC ‡∏õ‡∏¥‡∏î
        }
    } else {
        console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö EMCImg ‡πÉ‡∏ô DOM");
    }
}

// üìå ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á EMC (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0)
let EMCState = 0;

// üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Toggle EMC (0 <-> 1) ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ MQTT
function toggleEMC() {
    EMCState = EMCState === 0 ? 1 : 0; // ‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ 0 <-> 1
    console.log(`üöÄ ‡∏™‡πà‡∏á MQTT: EMC = ${EMCState}`);

    // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ MQTT
    mqttClient.publish("DOAR/command", JSON.stringify({ EMC: EMCState }));

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
    updateEMCGUI(EMCState);
}

// üìå ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ EMC ‡∏à‡∏≤‡∏Å MQTT ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
mqttClient.on("message", function (topic, message) {
    try {
        var data = JSON.parse(message.toString());
        console.log(`üì© Received MQTT Data from ${topic}:`, data);

        if (topic === "DOAR" && data.EMC !== undefined) {
            let EMCValue = parseInt(data.EMC, 10);
            console.log("‚úÖ EMC Value Received:", EMCValue);
            if (!isNaN(EMCValue) && (EMCValue === 0 || EMCValue === 1)) {
                EMCState = EMCValue; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                updateEMCGUI(EMCValue);
            }
        }

    } catch (error) {
        console.error("‚ùå Error parsing MQTT message:", error);
    }
});

// ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å `localStorage` ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
document.addEventListener("DOMContentLoaded", function() {
    console.log("üìå DOM Loaded, ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ...");

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ Wheel ‡∏à‡∏≤‡∏Å localStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    let savedWheel = localStorage.getItem("Wheel");
    if (savedWheel !== null) {
        let WheelValue = parseInt(savedWheel, 10);
        updateWheel(WheelValue);
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ EMC ‡∏à‡∏≤‡∏Å localStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    let savedEMC = localStorage.getItem("EMC");
    if (savedEMC !== null) {
        let EMCValue = parseInt(savedEMC, 10);
        updateEMCGUI(EMCValue);
    }

    console.log("‚úÖ ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤:", { Wheel: savedWheel, EMC: savedEMC });
});

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
function saveToLocalStorage(key, value) {
    localStorage.setItem(key, value);
}

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Toggle EMC (0 <-> 1) ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ MQTT
function toggleEMC() {
    EMCState = EMCState === 0 ? 1 : 0; // ‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ 0 <-> 1
    console.log(`üöÄ ‡∏™‡πà‡∏á MQTT: EMC = ${EMCState}`);

    // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ MQTT
    mqttClient.publish("DOAR/command", JSON.stringify({ EMC: EMCState }));

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ EMC ‡∏•‡∏á localStorage
    saveToLocalStorage("EMC", EMCState);

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
    updateEMCGUI(EMCState);
}

// üìå ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ EMC ‡∏à‡∏≤‡∏Å MQTT ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
mqttClient.on("message", function (topic, message) {
    try {
        var data = JSON.parse(message.toString());
        console.log(`üì© Received MQTT Data from ${topic}:`, data);

        if (topic === "DOAR" && data.EMC !== undefined) {
            let EMCValue = parseInt(data.EMC, 10);
            console.log("‚úÖ EMC Value Received:", EMCValue);
            if (!isNaN(EMCValue) && (EMCValue === 0 || EMCValue === 1)) {
                EMCState = EMCValue; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                saveToLocalStorage("EMC", EMCValue); // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤
                updateEMCGUI(EMCValue);
            }
        }

    } catch (error) {
        console.error("‚ùå Error parsing MQTT message:", error);
    }
});

// ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Wheel ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤
function updateWheel(WheelValue) {
    let imgWheelOn = document.getElementById("imgWheelOn");
    let imgWheelOff = document.getElementById("imgWheelOff");

    if (!imgWheelOn || !imgWheelOff) {
        console.warn("‚ö†Ô∏è Wheel images not found in the DOM");
        return;
    }

    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô
    imgWheelOn.style.display = "none";
    imgWheelOff.style.display = "none";

    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ WheelValue
    if (WheelValue === 1) {
        imgWheelOn.src = "/image/DOAR/Wheel/GIF/GIF-WHEEL-P2.gif?random=" + new Date().getTime();
        imgWheelOn.style.display = "block";
    } else {
        imgWheelOff.style.display = "block";
    }

    // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ Wheel ‡∏•‡∏á `localStorage`
    saveToLocalStorage("Wheel", WheelValue);
}

// üìå ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Wheel ‡∏à‡∏≤‡∏Å MQTT ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
mqttClient.on("message", function (topic, message) {
    try {
        var data = JSON.parse(message.toString());
        console.log("üì© Received MQTT Data:", data);

        if (data.Wheel !== undefined) {
            let WheelValue = parseInt(data.Wheel, 10);
            console.log("‚öôÔ∏è Wheel:", WheelValue);
            updateWheel(WheelValue); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
        }

    } catch (error) {
        console.error("‚ùå Error parsing MQTT message:", error);
    }
});


    </script>
    





  </body>
</html>
