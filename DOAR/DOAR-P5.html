<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viveport" content="width=device-width, initial-scale=1.0" />
    <title>Page Title</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <link rel="stylesheet" href="/DOAR/DOAR-P5.css" />
    <link rel="icon" type="image/x-icon" href="/image/HOME/LOGO VENCO .png">


  </head>
  <style>

    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠ hover */
    .hover-effect {
        transition: transform 0.3s ease-in-out;
    }
    
    .hover-effect:hover {
        transform: scale(1.1); /* ‡∏Ç‡∏¢‡∏≤‡∏¢ 10% */
    }
      </style>
  <body>


    <div class="GP">
      <a><img src="/image/DOAR/P5/BG.jpg"></a>
    </div>


<div class="GP">
  <div class="Previous">
    <a href="/DOAR/DOAR-P4.html"><img src="/image/DOAR/P5/PERVIOUS.png" width="170" height="190"></a>
  </div>

  <div class="GP">
    <div class="setsatemp">
      <a href="#" onclick="setSaAndDptSp()"><img src="/image/DOAR/P1/Not.png" width="100" height="100"  ></a>
  </div>
  <div class="setdpt">
    <a href="#" onclick="setSaAndDptSp()" ><img src="/image/DOAR/P1/Not.png" width="100" height="100"  ></a>
</div>

</div>



  <div class="GPbox1">
      <div class="GPbox4">
        <div id="SA_SP" class="box">2000</div>
      </div>
  </div>
  <div class="GPbox2">
    <div class="GPbox5">
      <div id="DPT_SP" class="box">2000</div>
    </div>
  </div>
    


</div>





<div class="GP">
    <div class="start">
        <a href="#" onclick="toggleStartStop('start')">
            <img id="startImg" class="hover-effect float" src="/image/DOAR/P4/BG-START.png" width="220" height="220">
        </a>
    </div>
    <div class="stop">
        <a href="#" onclick="toggleStartStop('stop')">
            <img id="stopImg" class="hover-effect float" src="/image/DOAR/P4/BG-STOP.png" width="220" height="220">
        </a>
    </div>
    <div class="wheel">
      <a href="#" onclick="toggleWheel()">
          <img id="wheelImg" class="hover-effect float" src="/image/DOAR/P4/BG-WHEEL p4.png" width="220" height="220">
      </a>
  </div>
  
    <div class="lighting">
      <a href="#" onclick="toggleLTG()">
      <img id="LTGImg" class="hover-effect float" src="/image/DOAR/P4/BG-LIGHTING.png" width="220" height="220" ></a>
    </div>
  
    <div class="auto">
      <a href="#" onclick="toggleAutoManual('Auto')">
          <img id="autoImg" class="hover-effect float" src="/image/DOAR/P4/BG-AUTO.png" width="220" height="220" >
      </a>
  </div>
  <div class="manual">
      <a href="#" onclick="toggleAutoManual('Manual')">
          <img id="manualImg" class="hover-effect float" src="/image/DOAR/P4/BG-MANUAL.png" width="220" height="220" >
      </a>
  </div>
  
  <div class="GP">
      <div class="EmerP2">
          <a href="#" onclick="toggleEMC()">
              <img id="EMCImg" class="hover-effect float" src="/image/DOAR/P2/BG-EMC.png" width="150" height="150">
        </a>
      </div>
        <div class="Normal">
            <a href="#" onclick="setMode(1)">
                <img id="modeImg1" class="hover-effect float" src="/image/DOAR/P4/BG-NORMAL.png" width="128" height="129">
          </a>
      </div>
      <div class="exhaust">
          <a href="#" onclick="setMode(2)">
              <img id="modeImg2" class="hover-effect float" src="/image/DOAR/P4/BG-EXHAUST.png" width="128" height="129">
          </a>
      </div>
      <div class="fresh">
          <a href="#" onclick="setMode(3)">
              <img id="modeImg3" class="hover-effect float" src="/image/DOAR/P4/BG-FRESH AIR.png" width="128" height="129">
          </a>
      </div>
      <div class="testsmoke">
          <a href="#" onclick="setMode(4)">
              <img id="modeImg4" class="hover-effect float" src="/image/DOAR/P4/BG-Test Smoke-31.png" width="128" height="129">
          </a>
      </div>
      
      <div class="home">
          <a href="/DOAR/DOAR-P1.html"><img src="/image/DOAR/P1/Not.png" width="328" height="129"></a>
      </div>
      
</div>




<script>
    // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT Broker ‡∏ú‡πà‡∏≤‡∏ô WebSockets
  const mqttClient = mqtt.connect("wss://2217876f209d4a73af014e541592ee16.s1.eu.hivemq.cloud:8884/mqtt", {
      username: "Venco",
      password: "12345678Venco",
      rejectUnauthorized: false 
  });
  
  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ Subscribe ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `DOAR` ‡πÅ‡∏•‡∏∞ `DOAR/command`
  mqttClient.on("connect", function () {
      console.log("‚úÖ MQTT Connected!");
      
      mqttClient.subscribe("DOAR", function (err) {
          if (!err) console.log("‚úÖ Subscribed to DOAR");
      });
  
      mqttClient.subscribe("DOAR/command/P5", function (err) {
          if (!err) console.log("‚úÖ Subscribed to DOAR/command/P5");
      });
  });
  
  // üì© ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å MQTT ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤
  mqttClient.on("message", function (topic, message) {
      try {
          var data = JSON.parse(message.toString());
          console.log(`üì© Received MQTT Data from ${topic}:`, data);
  
          // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
          if (data.set_ea !== undefined) updateElement("set_ea", data.set_ea);
          if (data.set_sa !== undefined) updateElement("set_sa", data.set_sa);
          if (data.set_ebm !== undefined) updateElement("set_ebm", data.set_ebm);
          if (data.max_ea !== undefined) updateElement("max_ea", data.max_ea);
          if (data.max_sa !== undefined) updateElement("max_sa", data.max_sa);
          if (data.SA_SP !== undefined) updateElement("SA_SP", data.SA_SP);
          if (data.DPT_SP !== undefined) updateElement("DPT_SP", data.DPT_SP)
  
          // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï START/STOP ‡∏à‡∏≤‡∏Å `cmd`
          if (topic === "DOAR" && data.cmd !== undefined && Array.isArray(data.cmd)) {
              let cmdValue = parseInt(data.cmd[0], 10);
              console.log("‚úÖ CMD Value Received:", cmdValue);
              if (!isNaN(cmdValue) && (cmdValue === 0 || cmdValue === 1)) {
                  updateStartStopUI(cmdValue);
              }
          }
  
          // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Auto/Manual ‡∏à‡∏≤‡∏Å `A_M`
          if (topic === "DOAR" && data.A_M !== undefined && Array.isArray(data.A_M)) {
              let A_MValue = parseInt(data.A_M[0], 10);
              console.log("‚úÖ AUTO/MANUAL Value Received:", A_MValue);
              if (!isNaN(A_MValue) && (A_MValue === 0 || A_MValue === 1)) {
                  updateAutoManualUI(A_MValue);
              }
          }
  
      } catch (error) {
          console.error("‚ùå Error parsing MQTT message:", error);
      }
  });
  
  // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ `commandData` ‡∏à‡∏≤‡∏Å localStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  let commandData = JSON.parse(localStorage.getItem("commandData")) || {
      START: 0,
      A_M: 0,
      Wheel: 0,
      LTG: 0,
      EMC: 0,
      Mode: 0,
      set_sa: 0,
      set_sa2: 0,
      set_ea: 0,
      SA_SP:0,
      DPT_SP:0
  };
  
  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ localStorage ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
  function saveCommandData() {
      localStorage.setItem("commandData", JSON.stringify(commandData));
  }
  
  
  function updateCommandAndSend(key, value) {
      commandData[key] = value; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô object
      saveCommandData(); // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
      console.log(`üöÄ ‡∏™‡πà‡∏á MQTT: ${key} = ${value}`, commandData);
      
      // ‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ MQTT
      mqttClient.publish("DOAR/command/P5", JSON.stringify(commandData));
  }
  
  
  function setSaAndDptSp(type) {
      let promptText = {
          "SA_SP": "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ SET SA_SP:",
          "DPT_SP": "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ SET DPT_SP:",
      }[type];
  
      let newValue = prompt(promptText, commandData[type]);
  
      if (newValue !== null && newValue.trim() !== "" && !isNaN(newValue)) {
          newValue = parseFloat(newValue);
          updateCommandAndSend(type, newValue);
          updateElement(type, newValue);
      } else {
          alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
      }
  }
  
  
  
  // üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° START/STOP ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `cmd`
  function updateStartStopUI(value) {
      let startImg = document.getElementById("startImg");
      let stopImg = document.getElementById("stopImg");
  
      if (startImg && stopImg) {
          console.log("üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ CMD:", value);
          if (value === 1) {
              startImg.src = "/image/DOAR/icon/N4-19.png"; 
              stopImg.src = "/image/DOAR/P4/BG-STOP.png";
          } else {
              stopImg.src = "/image/DOAR/icon/N4-20.png"; 
              startImg.src = "/image/DOAR/P4/BG-START.png"; 
          }
      } else {
          console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö startImg ‡∏´‡∏£‡∏∑‡∏≠ stopImg ‡πÉ‡∏ô DOM");
      }
  }
  
  // üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° Auto/Manual ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `A_M`
  function updateAutoManualUI(value) {
      let autoImg = document.getElementById("autoImg");
      let manualImg = document.getElementById("manualImg");
  
      if (autoImg && manualImg) {
          console.log("üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏´‡∏°‡∏î AUTO/MANUAL ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤:", value);
          if (value === 1) {
              autoImg.src = "/image/DOAR/icon/N4-23.png"; 
              manualImg.src = "/image/DOAR/icon/BG-MANUAL.png";
          } else {
              manualImg.src = "/image/DOAR/icon/N4-24.png"; 
              autoImg.src = "/image/DOAR/icon/BG-AUTO.png";
          }
      } else {
          console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö autoImg ‡∏´‡∏£‡∏∑‡∏≠ manualImg ‡πÉ‡∏ô DOM");
      }
  }
  
  // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á Wheel (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0)
  let wheelState = 0;
  
  // üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° Wheel ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `Wheel`
  function updateWheelUI(value) {
      let wheelImg = document.getElementById("wheelImg");
  
      if (wheelImg) {
          console.log("üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ Wheel:", value);
          if (value === 1) {
              wheelImg.src = "/image/DOAR/icon/N4-21.png"; // ‡∏£‡∏π‡∏õ Wheel ‡πÄ‡∏õ‡∏¥‡∏î
          } else {
              wheelImg.src = "/image/DOAR/P4/BG-WHEEL p4.png"; // ‡∏£‡∏π‡∏õ Wheel ‡∏õ‡∏¥‡∏î
          }
      } else {
          console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö wheelImg ‡πÉ‡∏ô DOM");
      }
  }
  
  function toggleWheel() {
      commandData.Wheel = commandData.Wheel === 0 ? 1 : 0;
      updateCommandAndSend("Wheel", commandData.Wheel);
      updateWheelUI(commandData.Wheel);
  }
  
  // üìå ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Wheel ‡∏à‡∏≤‡∏Å MQTT ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
  mqttClient.on("message", function (topic, message) {
      try {
          var data = JSON.parse(message.toString());
          console.log(`üì© Received MQTT Data from ${topic}:`, data);
  
          if (topic === "DOAR" && data.Wheel !== undefined && Array.isArray(data.Wheel)) {
              let wheelValue = parseInt(data.Wheel[0], 10);
              console.log("‚úÖ Wheel Value Received:", wheelValue);
              if (!isNaN(wheelValue) && (wheelValue === 0 || wheelValue === 1)) {
                  wheelState = wheelValue; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                  updateWheelUI(wheelValue);
              }
          }
  
      } catch (error) {
          console.error("‚ùå Error parsing MQTT message:", error);
      }
  });
  
  
  function toggleStartStop(action) {
      let newValue = (action === "start") ? 1 : 0;
      updateCommandAndSend("START", newValue);
      updateStartStopUI(newValue);
  }
  function toggleAutoManual(action) {
      let newValue = (action === "Auto") ? 1 : 0;
      updateCommandAndSend("A_M", newValue);
      updateAutoManualUI(newValue);
  }
  
  
  // üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô HTML
  function updateElement(id, value) {
      let element = document.getElementById(id);
      if (element && value !== undefined) {
          element.innerText = parseFloat(value); 
      }
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
  document.addEventListener("DOMContentLoaded", function() {
      console.log("üìå DOM Loaded, Ready to receive MQTT messages.");
  });
  
  // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏≠‡∏á MQTT
  mqttClient.on("error", function (error) {
      console.error("‚ùå MQTT Error:", error);
  });
  
  mqttClient.on("close", function () {
      console.warn("‚ö†Ô∏è MQTT Disconnected! Reconnecting...");
  });
  
  // üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° LTG ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `LTG`
  function updateLTGUI(value) {
      let LTGImg = document.getElementById("LTGImg"); // ‡πÉ‡∏ä‡πâ LTGImg ‡πÅ‡∏ó‡∏ô wheelImg
  
      if (LTGImg) {
          console.log("üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ LTG:", value);
          if (value === 1) {
              LTGImg.src = "/image/DOAR/icon/N4-22.png"; // ‡∏£‡∏π‡∏õ LTG ‡πÄ‡∏õ‡∏¥‡∏î
          } else {
              LTGImg.src = "/image/DOAR/P4/BG-LIGHTING.png"; // ‡∏£‡∏π‡∏õ LTG ‡∏õ‡∏¥‡∏î
          }
      } else {
          console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö LTGImg ‡πÉ‡∏ô DOM");
      }
  }
  // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á LTG (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0)
  let LTGState = 0;
  
  function toggleLTG() {
      commandData.LTG = commandData.LTG === 0 ? 1 : 0;
      updateCommandAndSend("LTG", commandData.LTG);
      updateLTGUI(commandData.LTG);
  }
  
  
  // üìå ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ LTG ‡∏à‡∏≤‡∏Å MQTT ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
  mqttClient.on("message", function (topic, message) {
      try {
          var data = JSON.parse(message.toString());
          console.log(`üì© Received MQTT Data from ${topic}:`, data);
  
          if (topic === "DOAR" && data.LTG !== undefined && Array.isArray(data.LTG)) {
              let LTGValue = parseInt(data.LTG[0], 10);
              console.log("‚úÖ LTG Value Received:", LTGValue);
              if (!isNaN(LTGValue) && (LTGValue === 0 || LTGValue === 1)) {
                  LTGState = LTGValue; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                  updateLTGUI(LTGValue);
              }
          }
  
      } catch (error) {
          console.error("‚ùå Error parsing MQTT message:", error);
      }
  });
  
  
  
  
  
  // üìå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° EMC ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `EMC`
  function updateEMCGUI(value) {
      let EMCImg = document.getElementById("EMCImg"); // ‡πÉ‡∏ä‡πâ EMCImg ‡πÅ‡∏ó‡∏ô LTGImg
  
      if (EMCImg) {
          console.log("üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ EMC:", value);
          if (value === 1) {
              EMCImg.src = "/image/DOAR/icon/EMC.png"; // ‡∏£‡∏π‡∏õ EMC ‡πÄ‡∏õ‡∏¥‡∏î
          } else {
              EMCImg.src = "/image/DOAR/P2/BG-EMC.png"; // ‡∏£‡∏π‡∏õ EMC ‡∏õ‡∏¥‡∏î
          }
      } else {
          console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö EMCImg ‡πÉ‡∏ô DOM");
      }
  }
  
  // üìå ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á EMC (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0)
  let EMCState = 0;
  
  function toggleEMC() {
      commandData.EMC = commandData.EMC === 0 ? 1 : 0;
      updateCommandAndSend("EMC", commandData.EMC);
      updateEMCGUI(commandData.EMC);
  }
  
  
  // üìå ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ EMC ‡∏à‡∏≤‡∏Å MQTT ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
  mqttClient.on("message", function (topic, message) {
      try {
          var data = JSON.parse(message.toString());
          console.log(`üì© Received MQTT Data from ${topic}:`, data);
  
          if (topic === "DOAR" && data.EMC !== undefined) {
              let EMCValue = parseInt(data.EMC, 10);
              console.log("‚úÖ EMC Value Received:", EMCValue);
              if (!isNaN(EMCValue) && (EMCValue === 0 || EMCValue === 1)) {
                  EMCState = EMCValue; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                  updateEMCGUI(EMCValue);
              }
          }
  
      } catch (error) {
          console.error("‚ùå Error parsing MQTT message:", error);
      }
  });
  
  
  function updateModeUI(value) {
      let modeImg1 = document.getElementById("modeImg1");
      let modeImg2 = document.getElementById("modeImg2");
      let modeImg3 = document.getElementById("modeImg3");
      let modeImg4 = document.getElementById("modeImg4");
  
      console.log("üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Mode UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤:", value);
  
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô
      modeImg1.src = "/image/DOAR/icon/BG-NORMAL.png";
      modeImg2.src = "/image/DOAR/icon/BG-FRESH AIR.png";
      modeImg3.src = "/image/DOAR/icon/BG-EXHAUST.png";
      modeImg4.src = "/image/DOAR/icon/BG-Test Smoke-31.png";
  
      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á Mode ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏õ‡∏¥‡∏î"
      if (value === 1) {
          modeImg1.src = "/image/DOAR/icon/N4-15.png"; // ‡∏£‡∏π‡∏õ Normal On
      } else if (value === 2) {
          modeImg2.src = "/image/DOAR/icon/N4-16.png"; // ‡∏£‡∏π‡∏õ Exhaust On
      } else if (value === 3) {
          modeImg3.src = "/image/DOAR/icon/N4-17.png"; // ‡∏£‡∏π‡∏õ Fresh Air On
      } else if (value === 4) {
          modeImg4.src = "/image/DOAR/icon/N4-18.png"; // ‡∏£‡∏π‡∏õ Test On
      }
      
  }
  function setMode(mode) {
      updateCommandAndSend("Mode", mode);
      updateModeUI(mode);
  }
  
  mqttClient.on("message", function (topic, message) {
      try {
          var data = JSON.parse(message.toString());
          console.log(`üì© Received MQTT Data from ${topic}:`, data);
  
          if (topic === "DOAR/command/P5") {
              // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å MQTT ‡πÑ‡∏õ‡∏ó‡∏µ‡πà commandData
              Object.keys(data).forEach(key => {
                  if (commandData.hasOwnProperty(key)) {
                      commandData[key] = data[key];
                  }
              });
  
              saveCommandData(); // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á localStorage
  
              // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
              updateElement("SA_SP", commandData.SA_SP);
              updateElement("DPT_SP", commandData.DPT_SP);
              updateElement("set_sa", commandData.set_sa);
              updateElement("set_sa2", commandData.set_sa2);
              updateElement("set_ea", commandData.set_ea);
              updateStartStopUI(commandData.START);
              updateAutoManualUI(commandData.A_M);
              updateWheelUI(commandData.Wheel);
              updateLTGUI(commandData.LTG);
              updateEMCGUI(commandData.EMC);
              updateModeUI(commandData.Mode);
          }
      } catch (error) {
          console.error("‚ùå Error parsing MQTT message:", error);
      }
  });
  
  
  mqttClient.on("message", function (topic, message) {
      try {
          var data = JSON.parse(message.toString());
          console.log(`üì© Received MQTT Data from ${topic}:`, data);
  
          if (topic === "DOAR" && data.mode !== undefined && Array.isArray(data.mode)) {
              let modeValue = parseInt(data.mode[0], 10);
              console.log("‚úÖ Mode Value Received:", modeValue);
              if (!isNaN(modeValue) && modeValue >= 1 && modeValue <= 4) {
                  updateModeUI(modeValue);
              }
          }
      } catch (error) {
          console.error("‚ùå Error parsing MQTT message:", error);
      }
  });
  
  
  
  
  </script>

  </body>
</html>